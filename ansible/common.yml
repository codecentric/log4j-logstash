---
 - name: Install Java on all machines
   hosts: all
   sudo: yes
   roles:
   - role: ahazem.java_ubuntu_saucy
     java_ubuntu_saucy_jdk: oracle
     java_ubuntu_saucy_jdk_version: 8
     java_ubuntu_saucy_jdk_version_default: 8
 - name: Set up the tomcat machine
   hosts: tomcat
   sudo: yes
   tasks: 
   - name: Install Maven
     apt: name="maven"
   - name: Install Git
     apt: name="git"
   - name: Download Tomcat
     get_url: url=http://apache.mirror.digionline.de/tomcat/tomcat-8/v8.0.12/bin/apache-tomcat-8.0.12.tar.gz dest=/tmp/apache-tomcat-8.0.12.tar.gz
   - name: Create Tomcat Target Directory
     file: path=/vagrant/local state=directory
   - name: Extract Tomcat
     unarchive: src=/tmp/apache-tomcat-8.0.12.tar.gz dest=/vagrant/local copy=no creates=/vagrant/local/apache-tomcat-8/bin/run.sh
   - name: Chown Tomcat Installation
     file: path=/vagrant/local/apache-tomcat-8.0.12 state=directory owner=vagrant group=vagrant
   - name: SymLink Tomcat Installation
     file: src=/vagrant/local/apache-tomcat-8.0.12 path=/vagrant/local/apache-tomcat-8 state=link
   - name: Create Init Configuration
     copy: src=files/tomcat dest=/etc/init.d/tomcat
   - name: Make Init Configuration Executable
     file: path=/etc/init.d/tomcat mode=0755
   - name: Start Tomcat
     service: name=tomcat state=started
 - name: Set up logstash machine
   hosts: logstash
   sudo: yes
   roles:
   - role: nginx
   - role: adham.helal.kibana
     es_host: http://localhost:9200
   tasks:
   - name: Add Logstash Key
     apt_key: url=http://packages.elasticsearch.org/GPG-KEY-elasticsearch state=present
   - name: Add Logstash Repository
     apt_repository: repo=' deb http://packages.elasticsearch.org/logstash/1.3/debian stable main' state=present
   - name: Install Logstash
     apt: name=logstash state=present update_cache=yes
